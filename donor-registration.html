<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donor Registration - RJF Blood Connect</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <!-- Favicon Links -->
    <link rel="icon" href="favicon.png" type="image/png">
    <link rel="icon" href="favicon.png" sizes="16x16" type="image/png">
    <link rel="icon" href="favicon.png" sizes="32x32" type="image/png">
    <link rel="apple-touch-icon" href="favicon.png">
</head>

<body>
    <!-- Header with Logo and Time -->
    <header class="header">
        <!-- Time and Date above the header content -->
        <div class="container-fluid py-1 bg-light">
            <div class="row">
                <div class="col-6 text-start">
                    <!-- Empty left side -->
                </div>
                <div class="col-6 text-end">
                    <div id="currentDate" class="bangla-text date-display"></div>
                    <div id="currentTime" class="bangla-text time-display"></div>
                </div>
            </div>
        </div>

        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-2">
                    <img src="roktojoba-logo.png" alt="Roktojoba Foundation Logo" class="logo">
                </div>
                <div class="col-8 text-center">
                    <h1>রক্তদাতা নিবন্ধন</h1>
                    <p class="tagline">Blood Donate. Connect. Save</p>
                </div>
                <div class="col-2 text-end">
                    <!-- You can keep this empty or add something else -->
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container py-4">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-user-plus me-2"></i>দাতা নিবন্ধন ফর্ম</h5>
                    </div>
                    <div class="card-body p-4">
                        <form id="donorForm" class="needs-validation" novalidate>
                            <!-- First Row -->
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label for="donorName" class="form-label">নাম <span
                                            class="text-danger">*</span></label>
                                    <input type="text" class="form-control form-control-lg" id="donorName"
                                        placeholder="আপনার পূর্ণ নাম লিখুন" required>
                                    <div class="invalid-feedback">অনুগ্রহ করে আপনার নাম লিখুন</div>
                                </div>
                                <div class="col-md-6">
                                    <label for="donorBloodGroup" class="form-label">রক্তের গ্রুপ <span
                                            class="text-danger">*</span></label>
                                    <select class="form-select form-select-lg" id="donorBloodGroup" required>
                                        <option value="" selected disabled>রক্তের গ্রুপ নির্বাচন করুন</option>
                                        <option value="A+">A+</option>
                                        <option value="A-">A-</option>
                                        <option value="B+">B+</option>
                                        <option value="B-">B-</option>
                                        <option value="AB+">AB+</option>
                                        <option value="AB-">AB-</option>
                                        <option value="O+">O+</option>
                                        <option value="O-">O-</option>
                                    </select>
                                    <div class="invalid-feedback">অনুগ্রহ করে আপনার রক্তের গ্রুপ নির্বাচন করুন</div>
                                </div>
                            </div>

                            <!-- Second Row -->
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label for="donorPhone" class="form-label">মোবাইল নম্বর (WhatsApp) <span
                                            class="text-danger">*</span></label>
                                    <div class="input-group">
                                        <span class="input-group-text">+88</span>
                                        <input type="tel" class="form-control form-control-lg" id="donorPhone"
                                            placeholder="01XXXXXXXXX" required pattern="^(01[3-9]\d{8})$">
                                    </div>
                                    <small class="text-muted">একটি সচল WhatsApp নম্বর অবশ্যই প্রদান করুন</small>
                                    <div class="invalid-feedback">অনুগ্রহ করে একটি বৈধ মোবাইল নম্বর লিখুন (01XXXXXXXXX)
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="lastDonationDate" class="form-label">সর্বশেষ রক্তদানের তারিখ</label>
                                    <input type="date" class="form-control form-control-lg" id="lastDonationDate">
                                    <small class="text-muted">আপনি যদি আগে কখনো রক্ত না দিয়ে থাকেন, এটি খালি
                                        রাখুন</small>
                                </div>
                            </div>

                            <!-- Third Row -->
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label for="totalDonations" class="form-label">পূর্বে কতবার রক্ত দান করেছেন</label>
                                    <input type="number" class="form-control form-control-lg" id="totalDonations"
                                        min="0" value="0">
                                    <small class="text-muted">আপনি যদি আগে কখনো রক্ত না দিয়ে থাকেন, এটি 0 রাখুন</small>    
                                </div>
                                <div class="col-md-6">
                                    <label for="donorDivision" class="form-label">বিভাগ <span
                                            class="text-danger">*</span></label>
                                    <select class="form-select form-select-lg" id="donorDivision" required>
                                        <option value="" selected disabled>বিভাগ নির্বাচন করুন</option>
                                        <!-- Divisions will be populated by JavaScript -->
                                    </select>
                                    <div class="invalid-feedback">অনুগ্রহ করে আপনার বিভাগ নির্বাচন করুন</div>
                                </div>
                            </div>

                            <!-- Fourth Row -->
                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <label for="donorDistrict" class="form-label">জেলা <span
                                            class="text-danger">*</span></label>
                                    <select class="form-select form-select-lg" id="donorDistrict" required disabled>
                                        <option value="" selected disabled>জেলা নির্বাচন করুন</option>
                                    </select>
                                    <div class="invalid-feedback">অনুগ্রহ করে আপনার জেলা নির্বাচন করুন</div>
                                </div>
                                <div class="col-md-6">
                                    <label for="donorUpazila" class="form-label">উপজেলা <span
                                            class="text-danger">*</span></label>
                                    <select class="form-select form-select-lg" id="donorUpazila" required disabled>
                                        <option value="" selected disabled>উপজেলা নির্বাচন করুন</option>
                                    </select>
                                    <div class="invalid-feedback">অনুগ্রহ করে আপনার উপজেলা নির্বাচন করুন</div>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <div class="row">
                                <div class="col-12">
                                    <button type="submit" class="btn btn-primary btn-lg w-100 py-3">
                                        <i class="fas fa-save me-2"></i>রক্তদাতা হিসেবে নিবন্ধন করুন
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Bar -->
    <div class="navigation">
        <div class="icons">
            <input type="radio" name="nav" id="nav-home" class="nav-radio" />
            <label for="nav-home" class="nav-icon" onclick="window.location.href='index.html'">
                <i class="fas fa-home"></i>
                <span class="nav-text bangla-text">হোম</span>
            </label>

            <input type="radio" name="nav" id="nav-register" class="nav-radio" />
            <label for="nav-register" class="nav-icon" onclick="window.location.href='donor-registration.html'">
                <i class="fas fa-user-plus"></i>
                <span class="nav-text bangla-text">নিবন্ধন</span>
            </label>

            <input type="radio" name="nav" id="nav-request" class="nav-radio" />
            <label for="nav-request" class="nav-icon" onclick="window.location.href='blood-request.html'">
                <i class="fas fa-tint"></i>
                <span class="nav-text bangla-text">অনুরোধ</span>
            </label>

            <input type="radio" name="nav" id="nav-search" class="nav-radio" />
            <label for="nav-search" class="nav-icon" onclick="window.location.href='donor-search.html'">
                <i class="fas fa-search"></i>
                <span class="nav-text bangla-text">খুঁজুন</span>
            </label>

            <input type="radio" name="nav" id="nav-info" class="nav-radio" />
            <label for="nav-info" class="nav-icon" onclick="window.location.href='information.html'">
                <i class="fas fa-info-circle"></i>
                <span class="nav-text bangla-text">তথ্য</span>
            </label>
        </div>
    </div>

    <!-- Emergency WhatsApp Button -->
    <a href="emergency-contact.html" class="emergency-btn">
        <i class="fas fa-phone-alt"></i>
    </a>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">সফল!</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="successMessage">
                    অপারেশন সফলভাবে সম্পন্ন হয়েছে।
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">বন্ধ করুন</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div class="modal fade" id="errorModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">ত্রুটি!</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="errorMessage">
                    একটি ত্রুটি ঘটেছে।
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">বন্ধ করুন</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Developer Credit -->
    <div class="text-center mt-4 small text-muted">
        Developed by MD Tasrik Hossain |
        <a href="https://www.facebook.com/md.tasrik.hossain" class="text-decoration-none">Contact Developer</a>
    </div>

    <!-- Firebase and other scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBSgyeYCbyB8cMFdqMcNtDZeL4aM-_FfQ4",
            authDomain: "rjf-blood-connect.firebaseapp.com",
            databaseURL: "https://rjf-blood-connect-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "rjf-blood-connect",
            storageBucket: "rjf-blood-connect.firebasestorage.app",
            messagingSenderId: "536870508483",
            appId: "1:536870508483:web:1ce2211ec28f79ce514f76",
            measurementId: "G-34RDD8GL9C"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Bangladesh administrative data
        const bangladeshData = {
            divisions: [
                {
                    name: "ঢাকা",
                    districts: [
                        { name: "ঢাকা", upazilas: ["চক (বাতিল)", "আদাবর", "বাড্ডা", "বংশাল", "বিমান বন্দর", "বনানী", "ক্যান্টনমেন্ট", "চকবাজার", "দক্ষিণখান", "দারুসসালাম", "ডেমরা", "ধামরাই", "ধানমন্ডি", "দোহার", "ভাষানটেক", "ভাটারা", "গেন্ডারিয়া", "গুলশান", "হাতিরঝিল", "হাজারীবাগ", "যাত্রাবাড়ী", "কাফরুল", "কদমতলী", "কলাবাগান", "কামরাঙ্গীর চর", "খিলগাঁও", "খিলক্ষেত", "কেরানীগঞ্জ", "কোতয়ালী", "লালবাগ", "মিরপুর", "মোহাম্মদপুর", "মতিঝিল", "মুগদা", "নবাবগঞ্জ", "নিউ মার্কেট", "পল্লবী", "পল্টন", "রমনা", "রামপুরা", "সবুজবাগ", "রুপনগর", "সাভার", "শাহজাহানপুর", "শাহ্ আলী", "শাহবাগ", "শ্যামপুর", "শেরে বাংলা নগর", "সুত্রাপুর", "তেজগাঁও", "তেজগাঁও শিল্প এলাকা", "তুরাগ", "উত্তরা পশ্চিম", "উত্তরা পূর্ব", "উত্তর খান", "ওয়ারী"] },
                        { name: "ফরিদপুর", upazilas: ["আলফাডাঙ্গা", "ভাঙ্গা", "বোয়ালমারী", "চরভদ্রাসন", "ফরিদপুর সদর", "মধুখালী", "নগরকান্দা", "সদরপুর", "সালথা"] },
                        { name: "গাজীপুর", upazilas: ["গাজীপুর সদর", "কালিয়াকৈর", "কাপাসিয়া", "শ্রীপুর", "কালীগঞ্জ"] },
                        { name: "গোপালগঞ্জ", upazilas: ["গোপালগঞ্জ সদর", "কাশিয়ানি", "কোটালীপাড়া", "মুকসুদপুর", "টুংগীপাড়া"] },
                        { name: "কিশোরগঞ্জ", upazilas: ["অষ্টগ্রাম", "বাজিতপুর", "ভৈরব", "হোসেনপুর", "ইটনা", "করিমগঞ্জ", "কটিয়াদী", "কিশোরগঞ্জ সদর", "কুলিয়ারচর", "মিঠামইন", "নিকলী", "পাকুন্দিয়া", "তাড়াইল"] },
                        { name: "মাদারীপুর", upazilas: ["কালকিনি", "মাদারীপুর সদর", "রাজৈর", "শিবচর"] },
                        { name: "মানিকগঞ্জ", upazilas: ["দৌলতপুর", "ঘিওর", "হরিরামপুর", "মানিকগঞ্জ সদর", "সাটুরিয়া", "শিবালয়", "সিংগাইর"] },
                        { name: "মুন্সিগঞ্জ", upazilas: ["গজারিয়া", "লৌহজং", "মুন্সিগঞ্জ সদর", "সিরাজদিখান", "শ্রীনগর", "টঙ্গীবাড়ি"] },
                        { name: "নারায়ণগঞ্জ", upazilas: ["আড়াইহাজার", "বন্দর", "নারায়ণগঞ্জ সদর", "রূপগঞ্জ", "সোনারগাঁ"] },
                        { name: "নরসিংদী", upazilas: ["বেলাবো", "মনোহরদী", "নরসিংদী সদর", "পলাশ", "রায়পুরা", "শিবপুর"] },
                        { name: "রাজবাড়ী", upazilas: ["বালিয়াকান্দি", "গোয়ালন্দ", "পাংশা", "রাজবাড়ী সদর"] },
                        { name: "শরীয়তপুর", upazilas: ["ভেদরগঞ্জ", "দামুদ্যা", "গোসাইরহাট", "নড়িয়া", "শরীয়তপুর সদর", "জাজিরা"] },
                        { name: "টাঙ্গাইল", upazilas: ["বাসাইল", "ভুয়াপুর", "দেলদুয়ার", "ধনবাড়ী", "ঘাটাইল", "গোপালপুর", "কালিহাতী", "মধুপুর", "মির্জাপুর", "নাগরপুর", "সখিপুর", "টাঙ্গাইল সদর"] }
                    ]
                },
                {
                    name: "চট্টগ্রাম",
                    districts: [
                        { name: "বান্দরবান", upazilas: ["আলীকদম", "বান্দরবান সদর", "লামা", "নাইক্ষ্যংছড়ি", "রোয়াংছড়ি", "রুমা", "থানচি"] },
                        { name: "ব্রাহ্মণবাড়িয়া", upazilas: ["আখাউড়া", "বাঞ্ছারামপুর", "ব্রাহ্মণবাড়িয়া সদর", "কসবা", "নবীনগর", "নাসিরনগর", "সরাইল", "আশুগঞ্জ", "বিজয়নগর"] },
                        { name: "চাঁদপুর", upazilas: ["চাঁদপুর সদর", "ফরিদগঞ্জ", "হাইমচর", "হাজীগঞ্জ", "কচুয়া", "মতলব দক্ষিণ", "মতলব উত্তর", "শাহরাস্তি"] },
                        { name: "চট্টগ্রাম", upazilas: ["আনোয়ারা", "বাঁশখালী", "বোয়ালখালী", "চন্দনাইশ", "ফটিকছড়ি", "হাটহাজারী", "লোহাগাড়া", "মীরসরাই", "পটিয়া", "রাঙ্গুনিয়া", "রাউজান", "সন্দ্বীপ", "সাতকানিয়া", "সীতাকুণ্ড"] },
                        { name: "কুমিল্লা", upazilas: ["বরুড়া", "ব্রাহ্মণপাড়া", "বুড়িচং", "চান্দিনা", "চৌদ্দগ্রাম", "দাউদকান্দি", "দেবীদ্বার", "হোমনা", "কুমিল্লা সদর", "লাকসাম", "মনোহরগঞ্জ", "মেঘনা", "মুরাদনগর", "নাঙ্গলকোট", "কুমিল্লা আদর্শ সদর", "তিতাস"] },
                        { name: "কক্সবাজার", upazilas: ["চকরিয়া", "কক্সবাজার সদর", "কুতুবদিয়া", "মহেশখালী", "রামু", "টেকনাফ", "উখিয়া", "পেকুয়া"] },
                        { name: "ফেনী", upazilas: ["ছাগলনাইয়া", "দাগনভূঞা", "ফেনী সদর", "পরশুরাম", "সোনাগাজী", "ফুলগাজী"] },
                        { name: "খাগড়াছড়ি", upazilas: ["দিঘীনালা", "খাগড়াছড়ি সদর", "লক্ষ্মীছড়ি", "মহালছড়ি", "মানিকছড়ি", "মাটিরাঙ্গা", "পানছড়ি", "রামগড়"] },
                        { name: "লক্ষ্মীপুর", upazilas: ["লক্ষ্মীপুর সদর", "রায়পুর", "রামগঞ্জ", "রামগতি", "কমলনগর"] },
                        { name: "নোয়াখালী", upazilas: ["বেগমগঞ্জ", "চাটখিল", "কোম্পানীগঞ্জ", "হাতিয়া", "সেনবাগ", "নোয়াখালী সদর", "সোনাইমুড়ি", "সুবর্ণচর", "কবিরহাট"] },
                        { name: "রাঙ্গামাটি", upazilas: ["বাঘাইছড়ি", "বরকল", "কাউখালী", "বিলাইছড়ি", "কাপ্তাই", "জুরাছড়ি", "লংগদু", "নানিয়ারচর", "রাজস্থলী", "রাঙ্গামাটি সদর"] }
                    ]
                },
                {
                    name: "সিলেট",
                    districts: [
                        { name: "হবিগঞ্জ", upazilas: ["আজমিরীগঞ্জ", "বাহুবল", "বানিয়াচং", "চুনারুঘাট", "হবিগঞ্জ সদর", "লাখাই", "মাধবপুর", "নবীগঞ্জ", "শায়েস্তাগঞ্জ"] },
                        { name: "মৌলভীবাজার", upazilas: ["বড়লেখা", "জুড়ী", "কমলগঞ্জ", "কুলাউড়া", "মৌলভীবাজার সদর", "রাজনগর", "শ্রীমঙ্গল"] },
                        { name: "সুনামগঞ্জ", upazilas: ["বিশ্বম্ভরপুর", "ছাতক", "দিরাই", "ধর্মপাশা", "দোয়ারাবাজার", "জগন্নাথপুর", "জামালগঞ্জ", "সুল্লা", "সুনামগঞ্জ সদর", "তাহিরপুর"] },
                        { name: "সিলেট", upazilas: ["বালাগঞ্জ", "বিয়ানীবাজার", "বিশ্বনাথ", "কোম্পানীগঞ্জ", "ফেঞ্চুগঞ্জ", "গোলাপগঞ্জ", "গোয়াইনঘাট", "জৈন্তাপুর", "কানাইঘাট", "সিলেট সদর", "জাকিগঞ্জ", "দক্ষিণ সুরমা", "ওসমানী নগর"] }
                    ]
                },
                {
                    name: "রাজশাহী",
                    districts: [
                        { name: "বগুড়া", upazilas: ["আদমদীঘি", "বগুড়া সদর", "শেরপুর", "ধুনট", "ধুপচাঁচিয়া", "গাবতলী", "কাহালু", "নন্দীগ্রাম", "সাহজাদপুর", "সারিয়াকান্দি", "শিবগঞ্জ", "সোনাতলা"] },
                        { name: "চাঁপাইনবাবগঞ্জ", upazilas: ["ভোলাহাট", "গোমস্তাপুর", "নাচোল", "চাঁপাইনবাবগঞ্জ সদর", "শিবগঞ্জ"] },
                        { name: "জয়পুরহাট", upazilas: ["আক্কেলপুর", "জয়পুরহাট সদর", "কালাই", "ক্ষেতলাল", "পাঁচবিবি"] },
                        { name: "নওগাঁ", upazilas: ["আত্রাই", "বাদলগাছি", "ধামইরহাট", "মান্দা", "মহাদেবপুর", "নওগাঁ সদর", "নিয়ামতপুর", "পত্নীতলা", "পোরশা", "রাণীনগর", "সাপাহার"] },
                        { name: "নাটোর", upazilas: ["বাগাতিপাড়া", "বড়াইগ্রাম", "গুরুদাসপুর", "লালপুর", "নাটোর সদর", "সিংড়া"] },
                        { name: "পাবনা", upazilas: ["আটঘরিয়া", "বেড়া", "ভাঙ্গুড়া", "চাটমোহর", "ফরিদপুর", "ঈশ্বরদী", "পাবনা সদর", "সাঁথিয়া", "সুজানগর"] },
                        { name: "রাজশাহী", upazilas: ["বাগমারা", "বাগমারা", "চারঘাট", "দুর্গাপুর", "গোদাগাড়ী", "মোহনপুর", "পবা", "পুঠিয়া", "তানোর"] },
                        { name: "সিরাজগঞ্জ", upazilas: ["বেলকুচি", "চৌহালি", "কামারখন্দ", "কাজীপুর", "রায়গঞ্জ", "শাহজাদপুর", "সিরাজগঞ্জ সদর", "তারাশ", "উল্লাপাড়া"] }
                    ]
                },
                {
                    name: "রংপুর",
                    districts: [
                        { name: "দিনাজপুর", upazilas: ["বিরামপুর", "বীরগঞ্জ", "বিরল", "বোচাগঞ্জ", "চিরিরবন্দর", "ফুলবাড়ী", "ঘোড়াঘাট", "হাকিমপুর", "কাহারোল", "খানসামা", "দিনাজপুর সদর", "নবাবগঞ্জ", "পার্বতীপুর"] },
                        { name: "গাইবান্ধা", upazilas: ["ফুলছড়ি", "গাইবান্ধা সদর", "গোবিন্দগঞ্জ", "পলাশবাড়ী", "সাদুল্লাপুর", "সাঘাটা", "সুন্দরগঞ্জ"] },
                        { name: "কুড়িগ্রাম", upazilas: ["ভুরুঙ্গামারী", "চর রাজিবপুর", "চিলমারী", "ফুলবাড়ী", "কুড়িগ্রাম সদর", "নাগেশ্বরী", "রাজারহাট", "রৌমারী", "উলিপুর"] },
                        { name: "লালমনিরহাট", upazilas: ["আদিতমারী", "হাতিবান্ধা", "কালীগঞ্জ", "লালমনিরহাট সদর", "পাটগ্রাম"] },
                        { name: "নীলফামারী", upazilas: ["ডিমলা", "ডোমার", "জলঢাকা", "কিশোরগঞ্জ", "নীলফামারী সদর", "সৈয়দপুর"] },
                        { name: "পঞ্চগড়", upazilas: ["আটোয়ারী", "বোদা", "দেবীগঞ্জ", "পঞ্চগড় সদর", "তেতুলিয়া"] },
                        { name: "রংপুর", upazilas: ["বদরগঞ্জ", "গঙ্গাচড়া", "কাউনিয়া", "রংপুর সদর", "মিঠাপুকুর", "পীরগঞ্জ", "পীরগাছা", "তারাগঞ্জ"] },
                        { name: "ঠাকুরগাঁও", upazilas: ["বালিয়াডাঙ্গী", "হরিপুর", "পীরগঞ্জ", "রাণীশংকৈল", "ঠাকুরগাঁও সদর"] }
                    ]
                },
                {
                    name: "খুলনা",
                    districts: [
                        { name: "বাগেরহাট", upazilas: ["বাগেরহাট সদর", "চিতলমারী", "ফকিরহাট", "কচুয়া", "মোল্লাহাট", "মোংলা", "মোরেলগঞ্জ", "রামপাল", "শরণখোলা"] },
                        { name: "চুয়াডাঙ্গা", upazilas: ["আলমডাঙ্গা", "চুয়াডাঙ্গা সদর", "দামুড়হুদা", "জীবননগর"] },
                        { name: "যশোর", upazilas: ["অভয়নগর", "বাঘারপাড়া", "চৌগাছা", "ঝিকরগাছা", "কেশবপুর", "যশোর সদর", "মনিরামপুর", "শার্শা"] },
                        { name: "ঝিনাইদহ", upazilas: ["হরিণাকুণ্ড", "ঝিনাইদহ সদর", "কালীগঞ্জ", "কোটচাঁদপুর", "মহেশপুর", "শৈলকুপা"] },
                        { name: "খুলনা", upazilas: ["বটিয়াঘাটা", "দাকোপ", "ডুমুরিয়া", "দিঘলিয়া", "কয়রা", "পাইকগাছা", "ফুলতলা", "রূপসা", "তেরখাদা"] },
                        { name: "কুষ্টিয়া", upazilas: ["ভেড়ামারা", "দৌলতপুর", "খোকসা", "কুমারখালী", "কুষ্টিয়া সদর", "মিরপুর"] },
                        { name: "মাগুরা", upazilas: ["মাগুরা সদর", "মোহাম্মদপুর", "শালিখা", "শ্রীপুর"] },
                        { name: "মেহেরপুর", upazilas: ["গাংনি", "মেহেরপুর সদর", "মুজিবনগর"] },
                        { name: "নড়াইল", upazilas: ["কালিয়া", "লোহাগড়া", "নড়াইল সদর"] },
                        { name: "সাতক্ষীরা", upazilas: ["আসসুনি", "দেবহাটা", "কলারোয়া", "কালীগঞ্জ", "সাতক্ষীরা সদর", "শ্যামনগর", "তালা"] }
                    ]
                },
                {
                    name: "বরিশাল",
                    districts: [
                        { name: "বরিশাল", upazilas: ["আগৈলঝাড়া", "বাবুগঞ্জ", "বাকেরগঞ্জ", "বানারীপাড়া", "গৌরনদী", "হিজলা", "বরিশাল সদর", "মেহেন্দিগঞ্জ", "মুলাদী", "ওজিরপুর"] },
                        { name: "ভোলা", upazilas: ["ভোলা সদর", "বুরহানউদ্দিন", "চর ফ্যাশন", "দৌলতখান", "লালমোহন", "তজুমদ্দিন", "মনপুরা"] },
                        { name: "ঝালকাঠি", upazilas: ["ঝালকাঠি সদর", "কাঠালিয়া", "নলছিটি", "রাজাপুর"] },
                        { name: "পটুয়াখালী", upazilas: ["বাউফল", "দশমিনা", "গলাচিপা", "কলাপাড়া", "মির্জাগঞ্জ", "পটুয়াখালী সদর", "রাঙ্গাবালী", "দুমকি"] },
                        { name: "পিরোজপুর", upazilas: ["ভান্ডারিয়া", "কাউখালী", "মঠবাড়িয়া", "নাজিরপুর", "পিরোজপুর সদর", "নেছারাবাদ", "জিয়ানগর"] },
                        { name: "বরগুনা", upazilas: ["আমতলী", "বামনা", "বরগুনা সদর", "বেতাগী", "পাথরঘাটা", "তালতলী"] }
                    ]
                },
                {
                    name: "ময়মনসিংহ",
                    districts: [
                        { name: "জামালপুর", upazilas: ["বকশীগঞ্জ", "দেওয়ানগঞ্জ", "ইসলামপুর", "জামালপুর সদর", "মাদারগঞ্জ", "মেলান্দহ", "সরিষাবাড়ী"] },
                        { name: "ময়মনসিংহ", upazilas: ["ভালুকা", "ধোবাউড়া", "ফুলবাড়ীয়া", "গফরগাঁও", "গৌরীপুর", "হালুয়াঘাট", "ঈশ্বরগঞ্জ", "ময়মনসিংহ সদর", "মুক্তাগাছা", "নান্দাইল", "ফুলপুর", "ত্রিশাল"] },
                        { name: "নেত্রকোণা", upazilas: ["আটপাড়া", "বারহাট্টা", "দুর্গাপুর", "খালিয়াজুরী", "কেন্দুয়া", "মদন", "মোহনগঞ্জ", "নেত্রকোণা সদর", "পূর্বধলা"] },
                        { name: "শেরপুর", upazilas: ["ঝিনাইগাতী", "নকলা", "নালিতাবাড়ী", "শেরপুর সদর", "শ্রীবরদী"] }
                    ]
                }
            ]
        };

        // Format phone number
        function formatPhoneNumber(phone) {
            let cleaned = phone.replace(/\D/g, '');

            if (cleaned.startsWith('88')) {
                cleaned = cleaned.substring(2);
            } else if (cleaned.startsWith('+88')) {
                cleaned = cleaned.substring(3);
            }

            if (cleaned.length === 10 && cleaned.startsWith('1')) {
                cleaned = '0' + cleaned;
            }

            return cleaned;
        }

        // Populate divisions in a select element
        function populateDivisions(selectId) {
            const selectElement = document.getElementById(selectId);
            if (!selectElement || !bangladeshData?.divisions) return;

            // Clear existing options
            selectElement.innerHTML = '<option value="" selected disabled>বিভাগ নির্বাচন করুন</option>';

            // Add division options
            bangladeshData.divisions.forEach(division => {
                const option = document.createElement('option');
                option.value = division.name;
                option.textContent = division.name;
                selectElement.appendChild(option);
            });
        }

        // Update districts based on selected division
        function updateDistricts(divisionName, districtSelectId) {
            const districtSelect = document.getElementById(districtSelectId);
            if (!districtSelect) return;

            districtSelect.innerHTML = '<option value="" selected disabled>জেলা নির্বাচন করুন</option>';
            districtSelect.disabled = !divisionName;

            if (divisionName) {
                const division = bangladeshData.divisions.find(d => d.name === divisionName);
                if (division) {
                    division.districts.forEach(district => {
                        const option = document.createElement('option');
                        option.value = district.name;
                        option.textContent = district.name;
                        districtSelect.appendChild(option);
                    });
                    districtSelect.disabled = false;
                }
            }
        }

        // Update upazilas based on selected district
        function updateUpazilas(divisionName, districtName, upazilaSelectId) {
            const upazilaSelect = document.getElementById(upazilaSelectId);
            if (!upazilaSelect) return;

            upazilaSelect.innerHTML = '<option value="" selected disabled>উপজেলা নির্বাচন করুন</option>';
            upazilaSelect.disabled = !districtName;

            if (divisionName && districtName) {
                const division = bangladeshData.divisions.find(d => d.name === divisionName);
                if (division) {
                    const district = division.districts.find(d => d.name === districtName);
                    if (district) {
                        district.upazilas.forEach(upazila => {
                            const option = document.createElement('option');
                            option.value = upazila;
                            option.textContent = upazila;
                            upazilaSelect.appendChild(option);
                        });
                        upazilaSelect.disabled = false;
                    }
                }
            }
        }

        // Setup form validation
        function setupFormValidation(formId) {
            const form = document.getElementById(formId);
            if (!form) return;

            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }

                form.classList.add('was-validated');
            }, false);
        }

        document.addEventListener('DOMContentLoaded', function () {
            populateDivisions('donorDivision');
            setupFormValidation('donorForm');

            document.getElementById('donorDivision').addEventListener('change', function () {
                const divisionName = this.value;
                updateDistricts(divisionName, 'donorDistrict');
            });

            document.getElementById('donorDistrict').addEventListener('change', function () {
                const districtName = this.value;
                const divisionName = document.getElementById('donorDivision').value;
                updateUpazilas(divisionName, districtName, 'donorUpazila');
            });

            // Handle donor form submission (from App.html)
            document.getElementById('donorForm').addEventListener('submit', async function (e) {
                e.preventDefault();

                if (!donorForm.checkValidity()) {
                    e.stopPropagation();
                    return;
                }

                const donorData = {
                    name: document.getElementById('donorName').value,
                    bloodGroup: document.getElementById('donorBloodGroup').value,
                    phone: formatPhoneNumber(document.getElementById('donorPhone').value),
                    division: document.getElementById('donorDivision').value,
                    district: document.getElementById('donorDistrict').value,
                    upazila: document.getElementById('donorUpazila').value,
                    lastDonation: document.getElementById('lastDonationDate').value,
                    totalDonations: parseInt(document.getElementById('totalDonations').value) || 0,
                    registrationDate: new Date().toISOString(),
                    status: "active",
                    availability: "available"
                };

                try {
                    // Check if donor already exists
                    const q = query(
                        collection(db, 'donors'),
                        where('phone', '==', donorData.phone),
                        where('status', '==', 'active')
                    );

                    const querySnapshot = await getDocs(q);

                    if (!querySnapshot.empty) {
                        document.getElementById('errorMessage').textContent =
                            `এই ফোন নম্বর (${donorData.phone}) দিয়ে ইতিমধ্যে একজন রক্তদাতা নিবন্ধিত আছে।`;
                        const errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
                        errorModal.show();
                        return;
                    }

                    // Add new donor
                    await addDoc(collection(db, 'donors'), donorData);

                    document.getElementById('successMessage').textContent =
                        "রক্তদাতা হিসেবে নিবন্ধনে করার জন্য আপনাকে ধন্যবাদ, একটি জীবন বাঁচানোর স্বপ্ন আজ হলো অঙ্কিত! রক্ত দান শুধু উপহার নয়, এটি মহানুভবতার চিহ্ন, আপনার এই দানেই হয়তো কেউ পেল নতুন প্রাণের স্পর্শ!";
                    const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                    successModal.show();
                    donorForm.reset();
                    donorForm.classList.remove('was-validated');
                } catch (error) {
                    document.getElementById('errorMessage').textContent =
                        'ত্রুটি: ' + error.message;
                    const errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
                    errorModal.show();
                }
            });
        });
        // Function to update time and date separately
        function updateDateTime() {
            const now = new Date();

            // Time options
            const timeOptions = {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };

            // Date options
            const dateOptions = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            };

            document.getElementById('currentTime').textContent = now.toLocaleTimeString('bn-BD', timeOptions);
            document.getElementById('currentDate').textContent = now.toLocaleDateString('bn-BD', dateOptions);
        }

        // Update every second
        setInterval(updateDateTime, 1000);

        // Initial call
        updateDateTime();
        // Highlight current page in navigation
        document.addEventListener('DOMContentLoaded', function () {
            const currentPage = window.location.pathname.split('/').pop() || 'index.html';
            const navItems = {
                'index.html': 'nav-home',
                'donor-registration.html': 'nav-register',
                'blood-request.html': 'nav-request',
                'donor-search.html': 'nav-search',
                'information.html': 'nav-info'
            };

            if (navItems[currentPage]) {
                document.getElementById(navItems[currentPage]).checked = true;
            }
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script.js"></script>
</body>

</html>